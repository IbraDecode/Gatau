#!/usr/bin/env node
import { spawn } from 'child_process';
import path from 'path';

const cmd = process.argv[2] || 'help';

if (cmd === 'serve') {
  const p = spawn(process.execPath, [path.join(process.cwd(), 'index.js')], { stdio: 'inherit' });
  p.on('exit', c => process.exit(c));
} else if (cmd === 'migrate') {
  (async () => {
    const migrations = [
      './database/migrations/2025_11_09_000000_create_users_table.js',
      './database/migrations/2025_11_09_000001_create_memories_table.js'
    ];
    for (const m of migrations) {
      const mod = await import(path.join(process.cwd(), m));
      if (mod.default && typeof mod.default.up === 'function') {
        await mod.default.up();
        console.log('migrated', m);
      }
    }
    process.exit(0);
  })();
} else if (cmd === 'seed') {
  (async () => {
    const seeder = await import(path.join(process.cwd(), './database/seeders/MemorySeeder.js'));
    if (seeder.default && typeof seeder.default.run === 'function') {
      await seeder.default.run();
      console.log('seeded');
    }
    process.exit(0);
  })();
} else if (cmd === 'help') {
  console.log('Usage: node artisan [serve|migrate|seed]');
  process.exit(0);
} else {
  console.log('Unknown command');
  process.exit(1);
}
